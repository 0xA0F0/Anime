const textarea=document.getElementById("commentInput"),maxHeight=410;function insertListBBCode(){document.getElementById("commentInput"),replaceSelectedTextWithBBCode("[_list\n\n]")}function replaceSelectedTextWithBBCode(e){let t=document.getElementById("commentInput");t.value.substring(t.selectionStart,t.selectionEnd);let n=t.value.substring(0,t.selectionStart)+e+t.value.substring(t.selectionEnd);t.value=n}function insertImageBBCode(e,t,n){document.getElementById("commentInput");let l=`[img=${e}`;t&&n&&(l+=` w=${t} h=${n}`),replaceSelectedTextWithBBCode(l+="]")}function replaceSelectedTextWithTag(e){let t=document.getElementById("commentInput"),n=t.value.substring(t.selectionStart,t.selectionEnd),l=t.value.substring(0,t.selectionStart)+`[${e}]${n}[/${e}]`+t.value.substring(t.selectionEnd);t.value=l}function insertSpoilerBBCode(){document.getElementById("commentInput"),replaceSelectedTextWithBBCode("[spoiler=спойлер] [/spoiler]")}function insertLinkBBCode(){let e=document.getElementById("put-link").value.trim(),t=document.getElementById("link-name").value.trim();if(e&&t){/^https?:\/\//i.test(e)||(e="http://"+e);replaceSelectedTextWithBBCode(`[url=${e}]${t}[/url]`)}else document.getElementById("put-link").style.boxShadow=e?"":"red 0px 0px 0px 2px",document.getElementById("link-name").style.boxShadow=t?"":"red 0px 0px 0px 2px",setTimeout(function(){document.getElementById("put-link").style.boxShadow="",document.getElementById("link-name").style.boxShadow=""},5e3)}function insertCodeBBCode(){let e=document.getElementById("commentInput"),t;replaceSelectedTextWithBBCode("[code=code]"+e.value.substring(e.selectionStart,e.selectionEnd)+"[/code]")}function insertImage(e,t){let n=document.getElementById("commentInput"),l=`[img=data:${t};base64,${e}]`;insertTextAtCursor(n,l)}function insertTextAtCursor(e,t){let n=e.selectionStart,l=e.selectionEnd,i=e.value.substring(0,n),a=e.value.substring(l,e.value.length);e.value=i+t+a,e.selectionStart=n+t.length,e.selectionEnd=n+t.length,e.focus()}textarea.addEventListener("input",()=>{if(textarea.style.height="auto",!textarea.value.trim()){textarea.style.removeProperty("height");return}textarea.scrollHeight<=410?textarea.style.height=textarea.scrollHeight+"px":textarea.style.height="410px"}),document.getElementById("put-list").addEventListener("click",function(){insertListBBCode()}),document.getElementById("put-img").addEventListener("click",function(e){e.preventDefault();let t=document.getElementById("image-url-input").value.trim(),n=document.getElementById("image-width-input").value.trim(),l=document.getElementById("image-height-input").value.trim();t?insertImageBBCode(t,n,l):(document.getElementById("image-url-input").style.boxShadow="red 0px 0px 0px 2px",setTimeout(function(){document.getElementById("image-url-input").style.boxShadow=""},5e3))}),document.getElementById("put-right").addEventListener("click",function(){replaceSelectedTextWithTag("right")}),document.getElementById("put-center").addEventListener("click",function(){replaceSelectedTextWithTag("center")}),document.getElementById("spoiler").addEventListener("click",function(){insertSpoilerBBCode()}),document.querySelector(".ok-link").addEventListener("click",function(){insertLinkBBCode()}),document.getElementById("put-code").addEventListener("click",function(){insertCodeBBCode()}),document.getElementById("imageFileInput").addEventListener("change",function(){let e=this.files[0];if(e){let t=new FileReader;t.readAsDataURL(e),t.onload=function(){let e=t.result;document.getElementById("image-url-input").value=e}}else document.getElementById("image-url-input").value=""}),document.getElementById("imageInput").addEventListener("change",function(){let e=this.files[0];if(e){let t=new FileReader;t.readAsDataURL(e),t.onload=function(){let n=t.result,l=e.type;insertImage(n,l)}}});